"use strict";(self.webpackChunkopen_metadata=self.webpackChunkopen_metadata||[]).push([[6434],{89586:function(e,n,t){var i=t(8081),r=t.n(i),a=t(23645),o=t.n(a)()(r());o.push([e.id,'/*\n *  Copyright 2023 Collate.\n *  Licensed under the Apache License, Version 2.0 (the "License");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *  http://www.apache.org/licenses/LICENSE-2.0\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an "AS IS" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n */\n/*\n *  Copyright 2022 Collate.\n *  Licensed under the Apache License, Version 2.0 (the "License");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *  http://www.apache.org/licenses/LICENSE-2.0\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an "AS IS" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n */\n/* navbar+tab_height+padding = 64+46+12  */\n.query-card-extra-option .button-size {\n  height: 26px;\n}\n.query-card-extra-option .vote-button {\n  height: 26px;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 12px;\n  line-height: 16px;\n  padding: 0 8px;\n}\n.query-card-extra-option .query-lines {\n  height: 26px;\n  margin-right: 0;\n  border-radius: 12px;\n  color: #757575;\n  border: 1px solid #0000001a;\n  background-color: #eeeeee;\n  display: flex;\n  align-items: center;\n  padding: 0 8px;\n}\n',""]),n.Z=o},74529:function(e,n,t){var i=t(8081),r=t.n(i),a=t(23645),o=t.n(a)()(r());o.push([e.id,'/*\n *  Copyright 2023 Collate.\n *  Licensed under the Apache License, Version 2.0 (the "License");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *  http://www.apache.org/licenses/LICENSE-2.0\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an "AS IS" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n */\n/*\n *  Copyright 2022 Collate.\n *  Licensed under the Apache License, Version 2.0 (the "License");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *  http://www.apache.org/licenses/LICENSE-2.0\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an "AS IS" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n */\n/* navbar+tab_height+padding = 64+46+12  */\n.query-entity-button {\n  position: absolute;\n  z-index: 10;\n  top: 63px;\n  right: 16px;\n}\n.query-card-container {\n  cursor: pointer;\n  position: relative;\n  border: 1px solid #0000001a;\n  border-radius: 4px;\n}\n.query-card-container .sql-editor-container {\n  overflow: hidden;\n  border-bottom-right-radius: 4px;\n}\n.query-card-container .ant-card-body {\n  padding: 1px 0 0;\n}\n.query-card-container.selected {\n  border-left: 3px solid #2196f3;\n}\n.query-right-panel {\n  position: sticky;\n  height: calc(100vh - 236px);\n  border: 1px solid #0000001a;\n  border-top: unset;\n  font-size: 14px;\n  overflow-y: scroll;\n  overflow-x: hidden;\n  -ms-overflow-style: none;\n  scrollbar-width: none;\n}\n.query-right-panel .ant-drawer-content-wrapper {\n  box-shadow: -2px 2px 4px rgba(0, 0, 0, 0.12);\n}\n.query-right-panel .ant-drawer-body {\n  padding: unset;\n}\n',""]),n.Z=o},48562:function(e,n,t){t.d(n,{q:function(){return l}});var i=t(70655),r=t(34041),a=t(96486),o=t(67294),s=t(69523),l=function(e){var n=e.options,t=e.api,l=(0,i._T)(e,["options","api"]),c=(0,i.CR)((0,o.useState)(),2),u=c[0],d=c[1],m=(0,i.CR)((0,o.useState)(!1),2),p=m[0],h=m[1];(0,o.useEffect)((function(){d(n)}),[n]);var f=(0,a.debounce)((function(e){h(!0),t(e).then((function(e){d(e),h(!1)}))}),300);return o.createElement(r.Z,(0,i.pi)({filterOption:!1,notFoundContent:p?o.createElement(s.Z,{size:"small"}):null,options:u,suffixIcon:o.createElement(s.Z,{size:"small"}),onSearch:function(e){f(e),h(!0)}},l))}},16434:function(e,n,t){t.d(n,{Z:function(){return be}});var i=t(70655),r=t(56256),a=t(71230),o=t(15746),s=t(91894),l=t(19650),c=t(71577),u=t(94184),d=t.n(u),m=t(96486),p=t(17126),h=t(80129),f=t.n(h),y=t(67294),v=t(68432),b=t(15137),g=t(96311),E=t(51569),q=t(51297),w=t(62761),C=t(89434),x=t(27914),N=t(64632),Z=t(97010),L=t(53429),S=t(68623),I=t(96840),T=t(95549),A=t(60331),R=t(13013),U=t(38780),k=t(8645),O=t(96071),D=t(7965),z=t(64134),V=t(52114),Y=t(93895),M=t(42356),_=t(52977),G=t(57112),F=t(46321),J=t(95137),W=t(93379),B=t.n(W),H=t(7795),P=t.n(H),K=t(90569),Q=t.n(K),j=t(3565),$=t.n(j),X=t(19216),ee=t.n(X),ne=t(44589),te=t.n(ne),ie=t(89586),re={};re.styleTagTransform=te(),re.setAttributes=$(),re.insert=Q().bind(null,"head"),re.domAPI=P(),re.insertStyleElement=ee(),B()(ie.Z,re),ie.Z&&ie.Z.locals&&ie.Z.locals;var ae=function(e){var n,t,r=e.permission,a=e.query,o=e.onUpdateVote,s=e.onEditClick,u=e.afterDeleteAction,d=r.EditAll,p=r.EditQueries,h=r.Delete,f=(0,J.Eu)().currentUser,b=(0,v.$)().t,g=(0,i.CR)((0,y.useState)(!1),2),E=g[0],q=g[1],w=(0,y.useMemo)((function(){return[{key:"edit-query",label:b("label.edit"),icon:y.createElement(U.ReactComponent,{height:16,opacity:d||p?1:.5,width:16}),disabled:!(d||p),onClick:function(){return s(!0)},title:d||p?void 0:V.oH},{key:"delete-query",label:b("label.delete"),icon:y.createElement(k.ReactComponent,{height:16,opacity:h?1:.5,width:16}),disabled:!h,onClick:function(){return q(!0)},title:h?void 0:V.oH}]}),[r]),C=(0,y.useMemo)((function(){var e=(0,m.split)(a.query,"\n").length;return(0,Y._6)(e,b("label.line"))}),[a]),x=(0,y.useMemo)((function(){var e,n=a.votes,t=null!==(e=null==f?void 0:f.id)&&void 0!==e?e:"";if((0,m.isUndefined)(n))return M.Y.unVoted;var i=n.upVoters||[],r=n.downVoters||[];return i.some((function(e){return e.id===t}))?M.Y.votedUp:r.some((function(e){return e.id===t}))?M.Y.votedDown:M.Y.unVoted}),[a,f]),N=function(e){var n;n=x===e?M.Y.unVoted:e,o({updatedVoteType:n},a.id)};return y.createElement(l.Z,{className:"query-card-extra-option","data-testid":"extra-option-container",size:8},y.createElement(A.Z,{className:"query-lines","data-testid":"query-line"},C),y.createElement(c.Z,{className:"vote-button","data-testid":"up-vote-btn",icon:x===M.Y.votedUp?y.createElement(D.ReactComponent,{color:"#008376",height:15,width:15}):y.createElement(z.ReactComponent,{height:15,width:15}),size:"small",onClick:function(){return N(M.Y.votedUp)}},(null===(n=a.votes)||void 0===n?void 0:n.upVotes)||0),y.createElement(c.Z,{className:"vote-button","data-testid":"down-vote-btn",icon:x===M.Y.votedDown?y.createElement(D.ReactComponent,{className:"rotate-inverse",color:"#E7B85D",height:15,width:15}):y.createElement(z.ReactComponent,{className:"rotate-inverse",height:15,width:15}),size:"small",onClick:function(){return N(M.Y.votedDown)}},(null===(t=a.votes)||void 0===t?void 0:t.downVotes)||0),y.createElement(R.Z,{destroyPopupOnHide:!0,arrow:{pointAtCenter:!0},menu:{items:w,style:{minWidth:"120px"}},placement:"bottomRight",trigger:["click"]},y.createElement(c.Z,{className:"flex-center button-size","data-testid":"more-option-btn",icon:y.createElement(O.ReactComponent,null),size:"small",type:"text"})),y.createElement(_.Z,{bodyText:b("message.delete-entity-permanently",{entityType:b("label.query")}),cancelText:b("label.cancel"),confirmText:b("label.delete"),header:b("label.delete-entity",{entity:b("label.query")}),visible:E,onCancel:function(){return q(!1)},onConfirm:function(){return(0,i.mG)(void 0,void 0,void 0,(function(){var e;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,(0,G.YF)(a.id||"")];case 1:return n.sent(),u(),[3,3];case 2:return e=n.sent(),(0,F.Eo)(e),[3,3];case 3:return[2]}}))}))}}))},oe=t(55241),se=t(76),le=t(48562),ce=t(69523),ue=t(22653),de=t(39117),me=t(24671),pe=r.Z.Text,he=function(e){var n=e.query,t=e.isEditMode,r=e.onChange,a=(0,v.$)().t,o=(0,i.CR)((0,y.useState)([]),2),s=o[0],c=o[1],u=(0,i.CR)((0,y.useState)(!1),2),d=u[0],p=u[1],h=(0,y.useMemo)((function(){var e=n.queryUsedIn,t={topThreeTable:[],remainingTable:[]};return(0,m.isUndefined)(e)||(t.topThreeTable=(0,m.slice)(e,0,C.KP),e.length>C.KP&&(t.remainingTable=(0,m.slice)(e,C.KP))),t}),[n]),f=h.topThreeTable,b=h.remainingTable,g=(0,y.useMemo)((function(){return y.createElement(pe,null,f.length?f.map((function(e,n){return y.createElement(pe,{className:"m-r-xss",key:e.name},y.createElement(se.Link,{to:(0,w.Gn)(e.fullyQualifiedName||"")},(0,me.C_)(e)),f.length-1!==n&&",")})):"--",b.length?y.createElement(y.Fragment,null,y.createElement(pe,{className:"m-r-xss"},a("label.and-lowercase")),y.createElement(oe.Z,{content:y.createElement(l.Z,{direction:"vertical"},b.map((function(e){return y.createElement(se.Link,{key:e.id,to:(0,w.Gn)(e.fullyQualifiedName||"")},(0,me.C_)(e))}))),placement:"bottom",trigger:"click"},y.createElement(pe,{className:"show-more","data-testid":"show-more"},b.length+" "+a("label.more-lowercase")))):null)}),[f,b]),E=function(e,n){(0,m.isArray)(n)&&r(n)},q=function(e){return void 0===e&&(e=""),(0,i.mG)(void 0,void 0,Promise,(function(){return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,(0,de.rg)(e,w.j2,w.Ou,"","","",ue.W.TABLE)];case 1:return[2,n.sent().data.hits.hits.map((function(e){return{label:(0,me.C_)(e._source),value:e._source.id}}))];case 2:return n.sent(),[2,[]];case 3:return[2]}}))}))},x=(0,y.useMemo)((function(){var e=n.queryUsedIn,t=(void 0===e?[]:e).map((function(e){return e.id}));return d?y.createElement(ce.Z,{size:"small"}):y.createElement(le.q,{api:q,className:"w-min-15","data-testid":"edit-query-used-in",defaultValue:t,mode:"multiple",options:s,placeholder:a("label.please-select-entity",{entity:a("label.query-used-in")}),size:"small",onChange:E})}),[n,s,d,q,E]);return(0,y.useEffect)((function(){t&&(0,i.mG)(void 0,void 0,void 0,(function(){var e,t,r;return(0,i.Jh)(this,(function(a){switch(a.label){case 0:p(!0),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,q()];case 2:return e=a.sent(),t=n.queryUsedIn,r=(void 0===t?[]:t).map((function(e){return{label:(0,me.C_)(e),value:e.id}})),c((0,m.uniqBy)((0,i.ev)((0,i.ev)([],(0,i.CR)(r)),(0,i.CR)(e)),"value")),[3,5];case 3:return a.sent(),c([]),[3,5];case 4:return p(!1),[7];case 5:return[2]}}))}))}),[t]),y.createElement(l.Z,{className:"m-b-0","data-testid":"para-container"},y.createElement(pe,null,a("message.query-used-by-other-tables")+":"),t?x:g)},fe=t(74529),ye={};ye.styleTagTransform=te(),ye.setAttributes=$(),ye.insert=Q().bind(null,"head"),ye.domAPI=P(),ye.insertStyleElement=ee(),B()(fe.Z,ye),fe.Z&&fe.Z.locals&&fe.Z.locals;var ve=r.Z.Text,be=function(e){var n,t=e.isExpanded,r=void 0!==t&&t,u=e.className,h=e.query,A=e.selectedId,R=e.onQuerySelection,U=e.onQueryUpdate,k=e.permission,O=e.onUpdateVote,D=e.afterDeleteAction,z=(0,v.$)().t,V=(0,b.UO)().fqn,Y=(0,b.TH)(),M=(0,b.k6)(),_=(0,Z.V)(h.query).onCopyToClipBoard,G=(0,y.useMemo)((function(){return(0,S.Vj)(Y.search)}),[Y.search]),F=(0,i.CR)((0,y.useState)(!1),2),J=F[0],W=F[1],B=(0,i.CR)((0,y.useState)({query:h.query,isLoading:!1}),2),H=B[0],P=B[1],K=(0,i.CR)((0,y.useState)(),2),Q=K[0],j=K[1],$=(0,y.useMemo)((function(){var e=(0,m.split)(h.query,"\n"),n=(0,L.to)(h.queryDate||0,C.Cb);return{isAllowExpand:e.length>C.v4,queryDate:n}}),[h]),X=$.isAllowExpand,ee=$.queryDate,ne=(0,y.useMemo)((function(){var e=h.duration;if(!(0,m.isUndefined)(e)){if(e<1)return z("label.runs-for")+" "+e+" ms";var n,t=p.nL.fromObject({milliseconds:e});return n=e<w.am?"s.S 'sec'":"m 'min' s 'sec'",t.toFormat("'"+z("label.runs-for")+"' "+n)}}),[h]);return y.createElement(a.Z,{gutter:[0,8]},y.createElement(o.Z,{span:24},y.createElement(s.Z,{bordered:!1,className:d()("query-card-container",{selected:A===(null==h?void 0:h.id)},u),extra:y.createElement(ae,{afterDeleteAction:D,permission:k,query:h,onEditClick:W,onUpdateVote:O}),title:y.createElement(l.Z,{className:"font-normal p-y-xs",size:8},y.createElement(ve,null,ee),ne&&y.createElement(y.Fragment,null,y.createElement(ve,{className:"text-gray-400"},w.zn),y.createElement(ve,{"data-testid":"query-run-duration"},ne))),onClick:function(){null==R||R(h)}},y.createElement(l.Z,{className:"query-entity-button",size:8},y.createElement(c.Z,{className:"flex-center bg-white","data-testid":"query-entity-expand-button",icon:r?y.createElement(g.ReactComponent,{height:16,width:16}):y.createElement(E.ReactComponent,{height:16,width:16}),onClick:function(){var e;r?M.push({search:f().stringify(G),pathname:(0,w.DV)(V,"table_queries")}):M.push({search:f().stringify((0,i.pi)((0,i.pi)({},G),{query:h.id})),pathname:(0,I.Xt)(V,null!==(e=h.id)&&void 0!==e?e:"")})}}),y.createElement(c.Z,{className:"flex-center bg-white","data-testid":"query-entity-copy-button",icon:y.createElement(q.ReactComponent,{height:16,width:16}),onClick:_})),y.createElement("div",{className:d()("sql-editor-container",!r&&{"h-max-24":!X,"h-24":!J,"h-max-56":J&&X})},y.createElement(T.Z,{editorClass:d()("custom-code-mirror-theme",{"full-screen-editor-height":r}),mode:{name:x.Q.SQL},options:{styleActiveLine:J,readOnly:!J&&"nocursor"},value:null!==(n=h.query)&&void 0!==n?n:"",onChange:function(e){P((function(n){return(0,i.pi)((0,i.pi)({},n),{query:e})}))}})),y.createElement(a.Z,{align:"middle",className:"p-y-xs border-top"},y.createElement(o.Z,{className:"p-y-0.5 p-l-md",span:16},y.createElement(he,{isEditMode:J,query:h,onChange:function(e){return j(e)}})),y.createElement(o.Z,{span:8},J&&y.createElement(l.Z,{align:"end",className:"w-full justify-end p-r-md",size:16},y.createElement(c.Z,{"data-testid":"cancel-query-btn",key:"cancel",size:"small",onClick:function(){return W(!1)}},z("label.cancel")),y.createElement(c.Z,{"data-testid":"save-query-btn",key:"save",loading:H.isLoading,size:"small",type:"primary",onClick:function(){return(0,i.mG)(void 0,void 0,void 0,(function(){var e;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return P((function(e){return(0,i.pi)((0,i.pi)({},e),{isLoading:!0})})),e=(0,i.pi)((0,i.pi)({},h),{query:h.query!==H.query?H.query:h.query,queryUsedIn:(0,m.isUndefined)(Q)?h.queryUsedIn:Q.map((function(e){var n,t,i=null===(n=h.queryUsedIn)||void 0===n?void 0:n.find((function(n){return n.id===e.value}));return null!=i?i:{id:null!==(t=e.value)&&void 0!==t?t:"",displayName:e.label,type:N.py.TABLE}}))}),h.query===H.query&&(0,m.isUndefined)(Q)?[3,2]:[4,U(e,"query")];case 1:n.sent(),n.label=2;case 2:return P((function(e){return(0,i.pi)((0,i.pi)({},e),{isLoading:!1})})),W(!1),[2]}}))}))}},z("label.save"))))))))}},89434:function(e,n,t){t.d(n,{Cb:function(){return a},KP:function(){return i},O8:function(){return o},v4:function(){return r},yC:function(){return s}});var i=3,r=4,a="'On' MMMM dd 'at' h:mma 'UTC'ZZ",o={page:!0,rightPanel:!0,query:!0},s={page:!1,search:!1}},57112:function(e,n,t){t.d(n,{HF:function(){return l},Id:function(){return c},MR:function(){return o},YF:function(){return d},gq:function(){return u},rc:function(){return s}});var i=t(70655),r=t(2598),a="/queries",o=function(e){return(0,i.mG)(void 0,void 0,void 0,(function(){return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return[4,r.Z.get(a,{params:e})];case 1:return[2,n.sent().data]}}))}))},s=function(e,n){return(0,i.mG)(void 0,void 0,void 0,(function(){return(0,i.Jh)(this,(function(t){switch(t.label){case 0:return[4,r.Z.get("/queries/"+e,{params:n})];case 1:return[2,t.sent().data]}}))}))},l=function(e){return(0,i.mG)(void 0,void 0,void 0,(function(){return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return[4,r.Z.post(a,e)];case 1:return[2,n.sent().data]}}))}))},c=function(e,n){return(0,i.mG)(void 0,void 0,void 0,(function(){var t;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return t={headers:{"Content-type":"application/json-patch+json"}},[4,r.Z.patch("/queries/"+e,n,t)];case 1:return[2,i.sent().data]}}))}))},u=function(e,n){return(0,i.mG)(void 0,void 0,void 0,(function(){return(0,i.Jh)(this,(function(t){switch(t.label){case 0:return[4,r.Z.put("/queries/"+e+"/vote",n)];case 1:return[2,t.sent().data]}}))}))},d=function(e){return(0,i.mG)(void 0,void 0,void 0,(function(){return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return[4,r.Z.delete("/queries/"+e)];case 1:return[2,n.sent().data]}}))}))}}}]);