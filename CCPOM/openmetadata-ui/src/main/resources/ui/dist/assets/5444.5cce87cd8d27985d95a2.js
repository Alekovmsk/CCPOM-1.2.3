"use strict";(self.webpackChunkopen_metadata=self.webpackChunkopen_metadata||[]).push([[5444],{48562:function(e,t,n){n.d(t,{q:function(){return l}});var r=n(70655),a=n(34041),i=n(96486),u=n(67294),s=n(69523),l=function(e){var t=e.options,n=e.api,l=(0,r._T)(e,["options","api"]),c=(0,r.CR)((0,u.useState)(),2),o=c[0],d=c[1],m=(0,r.CR)((0,u.useState)(!1),2),f=m[0],v=m[1];(0,u.useEffect)((function(){d(t)}),[t]);var p=(0,i.debounce)((function(e){v(!0),n(e).then((function(e){d(e),v(!1)}))}),300);return u.createElement(a.Z,(0,r.pi)({filterOption:!1,notFoundContent:f?u.createElement(s.Z,{size:"small"}):null,options:o,suffixIcon:u.createElement(s.Z,{size:"small"}),onSearch:function(e){p(e),v(!0)}},l))}},55444:function(e,t,n){n.r(t);var r=n(70655),a=n(49409),i=n(56256),u=n(19650),s=n(71577),l=n(94199),c=n(96486),o=n(67294),d=n(68432),m=n(15137),f=n(48562),v=n(95137),p=n(79686),y=n(18927),h=n(26387),b=n(8752),q=n(95549),E=n(19793),Z=n(62761),C=n(52114),g=n(27914),w=n(64632),R=n(22653),T=n(55546),I=n(39117),S=n(57112),G=n(77427),J=n(93895),x=n(53429),L=n(24671),N=n(46321);t.default=function(){var e,t,n=(0,d.$)().t,k=(0,v.Eu)().currentUser,F=(0,m.UO)().fqn,_=(0,b.BL)().permissions,P=(0,r.CR)(a.Z.useForm(),1)[0],U=(0,r.CR)((0,o.useState)([]),2),j=U[0],A=U[1],B=(0,r.CR)((0,o.useState)(""),2),O=B[0],W=B[1],H=(0,r.CR)((0,o.useState)(),2),z=H[0],D=H[1],V=(0,r.CR)((0,o.useState)(),2),Q=V[0],M=V[1],X=(0,r.CR)((0,o.useState)(!1),2),Y=X[0],$=X[1],K=function(e){return void 0===e&&(e=""),(0,r.mG)(void 0,void 0,Promise,(function(){var t,n;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,(0,I.rg)(e,Z.j2,Z.Ou,"","","",R.W.TABLE)];case 1:return t=r.sent().data,n=t.hits.hits.map((function(e){return{label:(0,L.C_)(e._source),value:e._source.id}})),[2,z?(0,c.filter)(n,(function(e){return e.value!==z.id})):n];case 2:return r.sent(),[2,[]];case 3:return[2]}}))}))};(0,o.useEffect)((function(){F&&(0,r.mG)(void 0,void 0,void 0,(function(){var e,t;return(0,r.Jh)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,(0,G.gs)(F,"")];case 1:return e=a.sent(),D(e),A((0,r.ev)((0,r.ev)([],(0,r.CR)((0,L.W7)(e,w.py.TABLE))),[{name:(0,L.C_)(e),url:(0,Z.DV)(F,"table_queries")},{name:n("label.add-entity",{entity:n("label.query")}),url:"",activeTitle:!0}])),[3,3];case 2:return t=a.sent(),(0,N.Eo)(t),[3,3];case 3:return[2]}}))}))}),[F]),(0,o.useEffect)((function(){z&&(0,r.mG)(void 0,void 0,void 0,(function(){var e;return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,K()];case 1:return e=t.sent(),M(e),[3,3];case 2:return t.sent(),M([]),[3,3];case 3:return[2]}}))}))}),[z]);var ee=function(){history.back()};return o.createElement(p.Z,{firstPanel:{children:o.createElement("div",{className:"max-width-md w-9/10 service-form-container"},o.createElement(h.Z,{titleLinks:j}),o.createElement("div",{className:"m-t-md"},o.createElement(i.Z.Paragraph,{className:"text-base","data-testid":"form-title"},n("label.add-new-entity",{entity:n("label.query")})),o.createElement(a.Z,{"data-testid":"query-form",form:P,id:"query-form",initialValues:{queryUsedIn:z?[z.id]:void 0},layout:"vertical",onFinish:function(e){return(0,r.mG)(void 0,void 0,Promise,(function(){var t,a,i,u,s;return(0,r.Jh)(this,(function(l){switch(l.label){case 0:t=(0,r.pi)((0,r.pi)({},e),{description:(0,c.isEmpty)(O)?void 0:O,owner:{id:null!==(i=null==k?void 0:k.id)&&void 0!==i?i:"",type:T.jc.USER},queryUsedIn:(0,r.ev)([{id:null!==(u=null==z?void 0:z.id)&&void 0!==u?u:"",type:w.py.TABLE}],(0,r.CR)((e.queryUsedIn||[]).map((function(e){return{id:e,type:w.py.TABLE}})))),queryDate:(0,x.Wi)(),service:(0,J.DS)(F,["service"])}),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,(0,S.HF)(t)];case 2:return l.sent(),(0,N.XA)(n("server.create-entity-success",{entity:n("label.query")})),$(!1),ee(),[3,4];case 3:return a=l.sent(),(null===(s=a.response)||void 0===s?void 0:s.status)===E.NL.CONFLICT?(0,N.Eo)(n("server.entity-already-exist-message-without-name",{entity:n("label.query"),entityPlural:n("label.query-lowercase-plural")})):(0,N.Eo)(n("server.create-entity-error",{entity:n("label.query-plural")})),$(!1),[3,4];case 4:return[2]}}))}))}},o.createElement(a.Z.Item,{"data-testid":"sql-editor-container",label:n("label.sql-uppercase-query"),name:"query",rules:[{required:!0,message:n("label.field-required",{field:n("label.sql-uppercase-query")})}],trigger:"onChange"},o.createElement(q.Z,{className:"custom-query-editor query-editor-h-200 custom-code-mirror-theme",mode:{name:g.Q.SQL},options:{readOnly:!1}})),o.createElement(a.Z.Item,{label:n("label.description")+":",name:"description"},o.createElement(y.Z,{height:"200px",initialValue:O,placeHolder:n("message.write-your-description"),style:{margin:0},onTextChange:function(e){return W(e)}})),o.createElement(a.Z.Item,{label:n("label.query-used-in")+":",name:"queryUsedIn"},o.createElement(f.q,{api:K,"data-testid":"query-used-in",mode:"multiple",options:Q,placeholder:n("label.please-select-entity",{entity:n("label.query-used-in")})})),o.createElement(a.Z.Item,null,o.createElement(u.Z,{className:"w-full justify-end",size:16},o.createElement(s.Z,{"data-testid":"cancel-btn",type:"default",onClick:ee},n("label.cancel")),o.createElement(l.Z,{placement:"top",title:!(null===(e=_.query)||void 0===e?void 0:e.Create)&&C.oH},o.createElement(s.Z,{"data-testid":"save-btn",disabled:!(null===(t=_.query)||void 0===t?void 0:t.Create),htmlType:"submit",loading:Y,type:"primary"},n("label.save")))))))),minWidth:700,flex:.7},pageTitle:n("label.add-entity",{entity:n("label.query")}),secondPanel:{children:o.createElement(o.Fragment,null,o.createElement(i.Z.Paragraph,{className:"text-base font-medium"},n("label.add-entity",{entity:n("label.query")})),o.createElement(i.Z.Text,null,n("message.add-query-helper-message"))),className:"p-md service-doc-panel",minWidth:60,overlay:{displayThreshold:200,header:n("label.setup-guide"),rotation:"counter-clockwise"}}})}},57112:function(e,t,n){n.d(t,{HF:function(){return l},Id:function(){return c},MR:function(){return u},YF:function(){return d},gq:function(){return o},rc:function(){return s}});var r=n(70655),a=n(2598),i="/queries",u=function(e){return(0,r.mG)(void 0,void 0,void 0,(function(){return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return[4,a.Z.get(i,{params:e})];case 1:return[2,t.sent().data]}}))}))},s=function(e,t){return(0,r.mG)(void 0,void 0,void 0,(function(){return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return[4,a.Z.get("/queries/"+e,{params:t})];case 1:return[2,n.sent().data]}}))}))},l=function(e){return(0,r.mG)(void 0,void 0,void 0,(function(){return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return[4,a.Z.post(i,e)];case 1:return[2,t.sent().data]}}))}))},c=function(e,t){return(0,r.mG)(void 0,void 0,void 0,(function(){var n;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n={headers:{"Content-type":"application/json-patch+json"}},[4,a.Z.patch("/queries/"+e,t,n)];case 1:return[2,r.sent().data]}}))}))},o=function(e,t){return(0,r.mG)(void 0,void 0,void 0,(function(){return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return[4,a.Z.put("/queries/"+e+"/vote",t)];case 1:return[2,n.sent().data]}}))}))},d=function(e){return(0,r.mG)(void 0,void 0,void 0,(function(){return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return[4,a.Z.delete("/queries/"+e)];case 1:return[2,t.sent().data]}}))}))}}}]);