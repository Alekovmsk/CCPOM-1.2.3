var e=require("analytics-utils"),s=require("@analytics/session-storage-utils"),t=require("@analytics/cookie-utils"),i=require("@analytics/global-storage-utils"),r=["id","createdAt","created"];function n(e){var s=e?new Date(e):new Date;return[s.toISOString(),s.getTime()]}function o(){var s=n(),t=s[0],i=s[1];return{id:e.uuid(),created:i,createdAt:t}}function a(e,t){for(var n={session:[s.getSessionItem,s.setSessionItem],page:[i.get,i.set]}[e],a=n[0],d=n[1],c=o(),g=!1,l={},p=0;p<r.length;p++){var v=r[p],x="__"+e+"__session__"+v,S=a(x);g=t||!S;var f=S&&!t?S:d(x,c[v]),_="created"!==v?f:Number(f);l[v]=_}return u(l,g)}function u(e,s){var t=Date.now();return e.elapsed=t-e.created,e.expires&&(e.remaining=Math.abs(e.expires-t)),e.isNew=s,e}function d(e,s){void 0===e&&(e=30);var i=t.getCookie("__session"),r=i?JSON.parse(i):c(e);return s?r:u(r,!i)}function c(e,s,i){void 0===e&&(e=30);var r=i?d(e,!0):o(),a=60*e,c=r.created;if(i){var g=n(),l=g[0],p=g[1];r.modified=p,r.modifiedAt=l,c=p}var v=n(c+1e3*a),x=v[0];return r.expires=v[1],r.expiresAt=x,s&&(r=Object.assign(r,s)),t.setCookie("__session",JSON.stringify(r),a),u(r,!i)}var g=a.bind(null,"session"),l=a.bind(null,"session",!0),p=a.bind(null,"page"),v=a.bind(null,"page",!0);exports.extendSession=function(e,s){return void 0===e&&(e=30),c(e||1,s,!0)},exports.getPageSession=p,exports.getSession=d,exports.getTabSession=g,exports.removeSession=function(){return t.removeCookie("__session")},exports.sessionData=o,exports.setPageSession=v,exports.setSession=c,exports.setTabSession=l;
//# sourceMappingURL=analytics-util-session.js.map
