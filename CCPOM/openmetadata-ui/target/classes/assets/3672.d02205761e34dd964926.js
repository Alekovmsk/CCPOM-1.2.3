"use strict";(self.webpackChunkopen_metadata=self.webpackChunkopen_metadata||[]).push([[3672],{83672:function(e,t,n){n.r(t);var a=n(70655),r=n(71230),l=n(15746),i=n(91894),s=n(56256),u=n(49409),c=n(19650),o=n(71577),m=n(34901),d=n(96486),f=n(67294),p=n(68432),b=n(15137),y=n(26387),E=n(69523),h=n(80646),v=n(19793),Z=n(96162),C=n(85303),w=n(80897),k=n(24671),N=n(96840),g=n(46321),S=n(87684),x=(0,N.DW)(Z.lx.POLICIES),L={name:"",description:"",resources:[],operations:[],condition:"",effect:C.Q.Allow};t.default=function(){var e=(0,p.$)().t,t=(0,b.k6)(),n=(0,b.UO)(),Z=n.fqn,C=n.ruleName,P=(0,a.CR)((0,f.useState)(!1),2),R=P[0],T=P[1],_=(0,a.CR)((0,f.useState)({}),2),D=_[0],I=_[1],O=(0,a.CR)((0,f.useState)(L),2),j=O[0],q=O[1],F=(0,f.useMemo)((function(){return[{name:"Settings",url:(0,N.si)()},{name:"Policies",url:x},{name:(0,k.C_)(D),url:(0,N.Hr)(Z)},{name:C,url:""}]}),[Z,D,C]),G=function(){t.push((0,N.Hr)(Z))};return(0,f.useEffect)((function(){(0,a.mG)(void 0,void 0,void 0,(function(){var e,t,n;return(0,a.Jh)(this,(function(a){switch(a.label){case 0:T(!0),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,(0,w.u7)(Z,"owner,location,teams,roles")];case 2:return(e=a.sent())?(I(e),t=e.rules.find((function(e){return e.name===C})),q(null!=t?t:L)):I({}),[3,5];case 3:return n=a.sent(),(0,g.Eo)(n),[3,5];case 4:return T(!1),[7];case 5:return[2]}}))}))}),[Z]),R?f.createElement(E.Z,null):f.createElement(h.Z,{pageTitle:e("label.edit-entity",{entity:e("label.rule")})},f.createElement(r.Z,{className:"h-auto p-y-xss",gutter:[16,16]},f.createElement(l.Z,{offset:5,span:14},f.createElement(y.Z,{className:"m-b-md",titleLinks:F}),f.createElement(i.Z,null,f.createElement(s.Z.Paragraph,{className:"text-base","data-testid":"edit-rule-title"},e("label.edit-entity",{entity:e("label.rule")})," ",'"'+C+'"'),f.createElement(u.Z,{"data-testid":"rule-form",id:"rule-form",initialValues:{ruleEffect:j.effect,ruleName:j.name,resources:j.resources,operations:j.operations,condition:j.condition},layout:"vertical",onFinish:function(){return(0,a.mG)(void 0,void 0,void 0,(function(){var t,n,r,l,i;return(0,a.Jh)(this,(function(s){switch(s.label){case 0:t=D.rules,n=t.map((function(e){if(e.name===C){var t=(0,a.pi)((0,a.pi)({},j),{name:(0,d.trim)(j.name)}),n=t.condition,r=(0,a._T)(t,["condition"]);return n?(0,a.pi)((0,a.pi)({},r),{condition:n}):r}return e})),r=(0,m.qu)(D,(0,a.pi)((0,a.pi)({},D),{rules:n})),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,(0,w.$j)(r,D.id)];case 2:return s.sent()&&G(),[3,4];case 3:return l=s.sent(),(null===(i=l.response)||void 0===i?void 0:i.status)===v.NL.CONFLICT?(0,g.Eo)(e("server.entity-already-exist",{entity:e("label.rule"),entityPlural:e("label.rule-lowercase-plural"),name:j.name})):(0,g.Eo)(l,e("server.entity-updating-error",{entity:e("label.rule-lowercase")})),[3,4];case 4:return[2]}}))}))}},f.createElement(S.Z,{ruleData:j,setRuleData:q}),f.createElement(c.Z,{align:"center",className:"w-full justify-end"},f.createElement(o.Z,{"data-testid":"cancel-btn",type:"link",onClick:G},e("label.cancel")),f.createElement(o.Z,{"data-testid":"submit-btn",form:"rule-form",htmlType:"submit",type:"primary"},e("label.submit"))))))))}}}]);