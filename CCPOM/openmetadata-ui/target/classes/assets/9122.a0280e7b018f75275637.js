"use strict";(self.webpackChunkopen_metadata=self.webpackChunkopen_metadata||[]).push([[9122],{71927:function(e,t,n){var a=n(8081),i=n.n(a),l=n(23645),r=n.n(l)()(i());r.push([e.id,'/*\n *  Copyright 2023 Collate.\n *  Licensed under the Apache License, Version 2.0 (the "License");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *  http://www.apache.org/licenses/LICENSE-2.0\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an "AS IS" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n */\n.stepper-container .ant-steps-item-content {\n  width: 120px;\n}\n',""]),t.Z=r},56091:function(e,t,n){n.d(t,{Z:function(){return C}});var a=n(75899),i=n(94184),l=n.n(i),r=n(67294),s=n(93379),u=n.n(s),c=n(7795),o=n.n(c),d=n(90569),m=n.n(d),p=n(3565),f=n.n(p),v=n(19216),y=n.n(v),h=n(44589),b=n.n(h),E=n(71927),S={};S.styleTagTransform=b(),S.setAttributes=f(),S.insert=m().bind(null,"head"),S.domAPI=o(),S.insertStyleElement=y(),u()(E.Z,S),E.Z&&E.Z.locals&&E.Z.locals;var C=function(e){var t=e.steps,n=e.activeStep,i=e.excludeSteps,s=void 0===i?[]:i,u=(0,r.useMemo)((function(){return t.filter((function(e){return!s.includes(e.step)})).map((function(e){return{icon:r.createElement("span",{className:l()("ingestion-rounder self-center",{active:e.step===n},{completed:e.step<n}),"data-testid":"step-icon-"+e.step}),key:e.name,title:e.name}}))}),[t,n,s]);return r.createElement("div",{className:"stepper-container p-x-24","data-testid":"stepper-container"},r.createElement(a.Z,{current:n,items:u,labelPlacement:"vertical",size:"small"}))}},69122:function(e,t,n){n.r(t),n.d(t,{default:function(){return K}});var a=n(70655),i=n(67294),l=n(15137),r=n(71230),s=n(15746),u=n(56256),c=n(23031),o=n(96486),d=n(80129),m=n.n(d),p=n(79686),f=n(29266),v=n(49408),y=n(21487),h=n(19793),b=n(62761),E=n(56275),S=n(64632),C=n(31968),g=n(86910),N=n(55546),Z=n(78802),T=n(24671),w=n(40734),I=n(46321),R=n(95137),O=n(59842),k=n(26387),L=n(56091),x=n(41539),F=n(49409),A=n(34041),Q=n(4107),D=n(19650),U=n(71577),V=n(99272),P=n.n(V),q=n(16139),J=n(99017),M=n(93895),j=n(38333),z=n(18927),G=n(30835),W=function(e){var t=e.initialValue,n=e.onSubmit,r=e.onCancel,s=e.table,u=(0,l.k6)(),d=(0,l.UO)(),p=d.entityTypeFQN,f=d.dashboardType,v=(0,w.p2)(p),y=f===g.xz.COLUMN,h=(0,a.CR)(F.Z.useForm(),1)[0],E=(0,i.useRef)(),S=(0,a.CR)((0,i.useState)([]),2),C=S[0],N=S[1],R=(0,a.CR)((0,i.useState)(null==t?void 0:t.testDefinition),2),O=R[0],k=R[1],L=(0,a.CR)((0,i.useState)([]),2),x=L[0],V=L[1],W=F.Z.useWatch("column",h),_=function(){var e=(0,o.isEmpty)(null==t?void 0:t.testSuite)?O:null==t?void 0:t.testSuite;return C.find((function(t){return t.fullyQualifiedName===e}))},Y=(0,i.useCallback)((function(){var e=_();if(null==e?void 0:e.parameterDefinition)return i.createElement(G.Z,{definition:e,table:s})}),[O,t,C]),B=function(e){var t,n,i,l=_(),r=null===(t=null==l?void 0:l.parameterDefinition)||void 0===t?void 0:t[0],u=Object.entries(e.params||{}).map((function(e){var t=(0,a.CR)(e,2),n=t[0],i=t[1];return{name:n,value:(null==r?void 0:r.dataType)===J.QP.Array?JSON.stringify(i.map((function(e){return e.value}))):i}})),c=(null===(n=e.testName)||void 0===n?void 0:n.trim())||(0,M.$I)(W||s.name)+"_"+(0,o.snakeCase)(O)+"_"+P()({length:4,type:"alphanumeric"});return{name:c,displayName:c,entityLink:(0,j.GJ)(y?v+"."+W:v,y),parameterValues:u,testDefinition:e.testTypeId,description:null===(i=E.current)||void 0===i?void 0:i.getEditorContent(),testSuite:""}},$=function(){var e;return null===(e=null==t?void 0:t.parameterValues)||void 0===e?void 0:e.reduce((function(e,t){var n,i,l;return(0,a.pi)((0,a.pi)({},e),((n={})[t.name||""]=(null===(l=null===(i=_())||void 0===i?void 0:i.parameterDefinition)||void 0===l?void 0:l[0].dataType)===J.QP.Array?JSON.parse((null==t?void 0:t.value)||"[]").map((function(e){return{value:e}})):null==t?void 0:t.value,n))}),{})};return(0,i.useEffect)((function(){(0,a.mG)(void 0,void 0,void 0,(function(){var e,t,n;return(0,a.Jh)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,(0,Z.ch)({limit:b.SF,entityType:y?J.py.Column:J.py.Table,testPlatform:J.EN.OpenMetadata,supportedDataType:y?null===(n=s.columns.find((function(e){return e.fullyQualifiedName===W})))||void 0===n?void 0:n.dataType:void 0})];case 1:return e=a.sent().data,N(e),[3,3];case 2:return t=a.sent(),(0,I.Eo)(t),[3,3];case 3:return[2]}}))}));var e=s.columns.find((function(e){return e.name===W}));e&&u.push({search:m().stringify({activeColumnFqn:null==e?void 0:e.fullyQualifiedName})})}),[W]),(0,i.useEffect)((function(){var e,n;(0,o.isEmpty)(x)&&(0,a.mG)(void 0,void 0,void 0,(function(){var e,t;return(0,a.Jh)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,(0,Z.Cz)({fields:"testDefinition",limit:b.SF,entityLink:(0,j.GJ)(y?v+"."+W:v,y)})];case 1:return e=n.sent().data,V(e),[3,3];case 2:return t=n.sent(),(0,I.Eo)(t),[3,3];case 3:return[2]}}))})),h.setFieldsValue({testName:(0,M.$I)(null!==(e=null==t?void 0:t.name)&&void 0!==e?e:""),testTypeId:null==t?void 0:t.testDefinition,params:(null===(n=null==t?void 0:t.parameterValues)||void 0===n?void 0:n.length)?$():void 0})}),[]),i.createElement(F.Z,{form:h,layout:"vertical",name:"tableTestForm",preserve:!1,onFinish:function(e){n(B(e))},onValuesChange:function(e){e.testTypeId&&k(e.testTypeId)}},y&&i.createElement(F.Z.Item,{label:(0,c.t)("label.column"),name:"column",rules:[{required:!0,message:""+(0,c.t)("label.field-required",{field:(0,c.t)("label.column")})}]},i.createElement(A.Z,{placeholder:(0,c.t)("label.please-select-entity",{entity:(0,c.t)("label.column-lowercase")})},s.columns.map((function(e){return i.createElement(A.Z.Option,{key:e.name},e.name)})))),i.createElement(F.Z.Item,{label:(0,c.t)("label.name"),name:"testName",rules:[{pattern:q.$Q,message:(0,c.t)("message.entity-name-validation")},{validator:function(e,t){return x.some((function(e){return e.name===t}))?Promise.reject((0,c.t)("message.entity-already-exists",{entity:(0,c.t)("label.name")})):Promise.resolve()}}]},i.createElement(Q.Z,{placeholder:(0,c.t)("message.enter-test-case-name")})),i.createElement(F.Z.Item,{label:(0,c.t)("label.test-type"),name:"testTypeId",rules:[{required:!0,message:""+(0,c.t)("label.field-required",{field:(0,c.t)("label.test-type")})}]},i.createElement(A.Z,{showSearch:!0,options:C.map((function(e){return{label:(0,T.C_)(e),value:e.fullyQualifiedName}})),placeholder:(0,c.t)("label.select-field",{field:(0,c.t)("label.test-type")})})),Y(),i.createElement(F.Z.Item,{label:(0,c.t)("label.description"),name:"description"},i.createElement(z.Z,{height:"200px",initialValue:(null==t?void 0:t.description)||"",ref:E,style:{margin:0}})),i.createElement(F.Z.Item,{noStyle:!0},i.createElement(D.Z,{className:"w-full justify-end",size:16},i.createElement(U.Z,{onClick:function(){var e=h.getFieldsValue();r(B(e))}},(0,c.t)("label.back")),i.createElement(U.Z,{"data-testid":"submit-test",htmlType:"submit",type:"primary"},(0,c.t)("label.submit")))))},_=n(78736),Y=n(20353),B=function(e){var t=e.table,n=(0,l.UO)(),d=n.entityTypeFQN,F=n.dashboardType,A=F===g.xz.COLUMN,Q=F===g.xz.TABLE,D=(0,l.k6)(),U=(0,a.CR)((0,i.useState)(1),2),V=U[0],P=U[1],q=(0,a.CR)((0,i.useState)(),2),J=q[0],M=q[1],j=(0,a.CR)((0,i.useState)(),2),z=j[0],G=j[1],B=(0,a.CR)((0,i.useState)(),2),$=B[0],H=B[1],K=(0,a.CR)((0,i.useState)(!1),2),X=K[0],ee=K[1],te=(0,R.Eu)().currentUser,ne=(0,i.useMemo)((function(){return(0,a.ev)((0,a.ev)([],(0,a.CR)((0,T.W7)(t,S.py.TABLE))),[{name:(0,T.C_)(t),url:(0,b.DV)(t.fullyQualifiedName||"","profiler")},{name:(0,c.t)("label.add-entity-test",{entity:A?(0,c.t)("label.column"):(0,c.t)("label.table")}),url:"",activeTitle:!0}])}),[t,d,A]),ae=(0,i.useMemo)((function(){var e;return{id:null!==(e=null==te?void 0:te.id)&&void 0!==e?e:"",type:N.jc.USER}}),[te]),ie=function(){var e;D.push({pathname:(0,b.DV)((0,w.Yd)(null!==(e=t.fullyQualifiedName)&&void 0!==e?e:""),S.M8.PROFILER),search:m().stringify({activeTab:f.O.DATA_QUALITY})})};(0,i.useEffect)((function(){G(t.testSuite)}),[t.testSuite]);var le=function(e){return(0,a.mG)(void 0,void 0,void 0,(function(){var n,i,l,r,s,u,d;return(0,a.Jh)(this,(function(m){switch(m.label){case 0:M(e),m.label=1;case 1:return m.trys.push([1,6,,7]),(0,o.isUndefined)(z)?[4,(0,a.mG)(void 0,void 0,void 0,(function(){var e,n;return(0,a.Jh)(this,(function(a){switch(a.label){case 0:return e={name:t.fullyQualifiedName+".testSuite",executableEntityReference:t.fullyQualifiedName,owner:ae},[4,(0,Z.yz)(e)];case 1:return n=a.sent(),G(n),[2,n]}}))}))]:[3,3];case 2:return i=m.sent(),[3,4];case 3:i=t.testSuite,m.label=4;case 4:return n=i,l=(0,a.pi)((0,a.pi)({},e),{owner:ae,testSuite:null!==(u=null==n?void 0:n.fullyQualifiedName)&&void 0!==u?u:""}),[4,(0,Z.rO)(l)];case 5:return r=m.sent(),P(2),H(r),[3,7];case 6:return s=m.sent(),(null===(d=s.response)||void 0===d?void 0:d.status)===h.NL.CONFLICT?(0,I.Eo)((0,c.t)("server.entity-already-exist",{entity:(0,c.t)("label.test-case"),entityPlural:(0,c.t)("label.test-case-lowercase-plural"),name:e.name})):(0,I.Eo)(s,(0,c.t)("server.create-entity-error",{entity:(0,c.t)("label.test-case-lowercase")})),[3,7];case 7:return[2]}}))}))},re=(0,i.useCallback)((function(){var e,n;if(2===V){var a=(0,o.isUndefined)(t.testSuite),l=a?void 0:i.createElement("span",null,i.createElement("span",{className:"font-medium"},'"'+(null!==(e=null==$?void 0:$.name)&&void 0!==e?e:(0,c.t)("label.test-case"))+'"'," "),i.createElement("span",null,(0,c.t)("message.has-been-created-successfully")+".","Â ",(0,c.t)("message.this-will-pick-in-next-run")));return i.createElement(O.Z,{handleIngestionClick:function(){return ee(!0)},handleViewServiceClick:ie,name:null!==(n=null==$?void 0:$.name)&&void 0!==n?n:(0,c.t)("label.test-case"),showIngestionButton:a,state:C.Y.ADD,successMessage:l,viewServiceText:(0,c.t)("message.view-test-suite")})}return i.createElement(W,{initialValue:J,table:t,onCancel:ie,onSubmit:le})}),[V,J,$,le,t]),se=(0,i.useMemo)((function(){var e=location.search;return m().parse(e.startsWith("?")?e.substring(1):e)}),[location.search]).activeColumnFqn,ue=i.createElement(i.Fragment,null,i.createElement(x.Z,{data:X?_.j$:(0,_.hY)(V,(0,o.isUndefined)(t.testSuite),{testCase:(null==J?void 0:J.name)||"",testSuite:(null==z?void 0:z.name)||""})}),Q&&i.createElement(y.Z,{dateRangeObject:E.ve,entityFqn:d}),A&&i.createElement(v.Z,{activeColumnFqn:se,dateRangeObject:E.ve}));return i.createElement(p.Z,{firstPanel:{children:i.createElement("div",{className:"max-width-md w-9/10 service-form-container"},i.createElement(k.Z,{titleLinks:ne}),i.createElement("div",{className:"m-t-md"},X?i.createElement(Y.Z,{testSuite:z,onCancel:function(){return ee(!1)}}):i.createElement(r.Z,{className:"p-xs",gutter:[16,16]},i.createElement(s.Z,{span:24},i.createElement(u.Z.Paragraph,{className:"heading text-base","data-testid":"header"},(0,c.t)("label.add-entity-test",{entity:A?(0,c.t)("label.column"):(0,c.t)("label.table")}))),i.createElement(s.Z,{span:24},i.createElement(L.Z,{activeStep:V,steps:E.pq})),i.createElement(s.Z,{span:24},re())))),minWidth:700,flex:.6},pageTitle:(0,c.t)("label.add-entity",{entity:(0,c.t)("label.data-quality-test")}),secondPanel:{children:ue,className:"p-md service-doc-panel",minWidth:60,flex:.4,overlay:{displayThreshold:200,header:(0,c.t)("label.data-profiler-metrics"),rotation:"counter-clockwise"}}})},$=n(69523),H=n(77427),K=function(){var e=(0,l.UO)().entityTypeFQN,t=(0,a.CR)((0,i.useState)({}),2),n=t[0],r=t[1],s=(0,a.CR)((0,i.useState)(!0),2),u=s[0],c=s[1];return(0,i.useEffect)((function(){(0,a.mG)(void 0,void 0,void 0,(function(){var t,n;return(0,a.Jh)(this,(function(a){switch(a.label){case 0:c(!0),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,(0,H.gs)(e,"testSuite")];case 2:return t=a.sent(),r(t),[3,5];case 3:return n=a.sent(),(0,I.Eo)(n),[3,5];case 4:return c(!1),[7];case 5:return[2]}}))}))}),[e]),u?i.createElement($.Z,null):i.createElement("div",{className:"self-center"},i.createElement(B,{table:n}))}}}]);