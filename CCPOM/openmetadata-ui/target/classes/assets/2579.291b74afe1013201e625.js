"use strict";(self.webpackChunkopen_metadata=self.webpackChunkopen_metadata||[]).push([[2579],{71068:function(e,t,n){var a=n(8081),i=n.n(a),s=n(23645),l=n.n(s)()(i());l.push([e.id,'/*\n *  Copyright 2022 Collate.\n *  Licensed under the Apache License, Version 2.0 (the "License");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *  http://www.apache.org/licenses/LICENSE-2.0\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an "AS IS" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n */\n.assignee-tag {\n  display: flex;\n  align-items: center;\n  padding: 2px 3px;\n  margin: 1px 2px;\n}\n.assignee-item .profile-image {\n  vertical-align: middle;\n}\n',""]),t.Z=l},41953:function(e,t,n){var a=n(8081),i=n.n(a),s=n(23645),l=n.n(s)()(i());l.push([e.id,'/*\n *  Copyright 2023 Collate.\n *  Licensed under the Apache License, Version 2.0 (the "License");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *  http://www.apache.org/licenses/LICENSE-2.0\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an "AS IS" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n */\n.request-tags .ant-select-custom,\n.request-description .ant-select-custom {\n  margin: 0;\n}\n.request-description .ant-tabs-description {\n  margin-top: 0;\n}\n.task-data {\n  width: unset;\n}\n',""]),t.Z=l},42105:function(e,t,n){var a=n(93379),i=n.n(a),s=n(7795),l=n.n(s),r=n(90569),o=n.n(r),c=n(3565),u=n.n(c),d=n(19216),m=n.n(d),p=n(44589),g=n.n(p),h=n(41953),f={};f.styleTagTransform=g(),f.setAttributes=u(),f.insert=o().bind(null,"head"),f.domAPI=l(),f.insertStyleElement=m(),i()(h.Z,f),h.Z&&h.Z.locals&&h.Z.locals},42579:function(e,t,n){n.r(t);var a=n(70655),i=n(56256),s=n(49409),l=n(4107),r=n(19650),o=n(71577),c=n(50963),u=n(96486),d=n(67294),m=n(68432),p=n(15137),g=n(98542),h=n(95137),f=n(79686),y=n(18927),b=n(26387),v=n(95969),E=n(69523),S=n(58369),T=n(64632),w=n(59583),Z=n(31615),C=n(76373),I=n(93895),k=n(24671),A=n(40734),L=n(86385),x=n(46321),N=n(25131);n(42105),t.default=function(){var e,t=(0,m.$)().t,n=(0,h.Eu)().currentUser,R=(0,p.TH)(),O=(0,p.k6)(),q=(0,a.CR)((0,c.useForm)(),1)[0],U=(0,d.useRef)(),D=(0,p.UO)(),F=D.entityType,P=D.fqn,V=new URLSearchParams(R.search),M=V.get("field"),W=V.get("value"),B=(0,a.CR)((0,d.useState)({}),2),Y=B[0],H=B[1],K=(0,a.CR)((0,d.useState)([]),2),_=K[0],j=K[1],z=(0,a.CR)((0,d.useState)([]),2),X=z[0],$=z[1],G=(0,a.CR)((0,d.useState)(""),2),J=G[0],Q=G[1],ee=(0,d.useMemo)((function(){return(0,L.wP)({value:W,entityType:F,entityData:Y,field:M,startMessage:"Request description"})}),[W,F,M,Y]),te=(0,d.useMemo)((function(){return(0,A.p2)(P)}),[F]),ne=function(){return M&&W?""+M+k.LV+W+k.LV+"description":S.Sn.DESCRIPTION};return(0,d.useEffect)((function(){(0,L.Dy)(F,P,H)}),[P,F]),(0,d.useEffect)((function(){var e=Y.owner,t=[];e&&(t=[{label:(0,k.C_)(e),value:e.id||"",type:e.type}],$(t),j(t)),q.setFieldsValue({title:ee.trimEnd(),assignees:t})}),[Y]),(0,u.isEmpty)(Y)?d.createElement(E.Z,null):d.createElement(f.Z,{firstPanel:{minWidth:700,flex:.6,children:d.createElement("div",{className:"max-width-md w-9/10 m-x-auto m-y-md d-grid gap-4"},d.createElement(b.Z,{titleLinks:(0,a.ev)((0,a.ev)([],(0,a.CR)((0,L.rM)(Y,F))),[{name:t("label.create-entity",{entity:t("label.task")}),activeTitle:!0,url:""}])}),d.createElement("div",{className:"m-t-0 request-description",key:"request-description"},d.createElement(i.Z.Paragraph,{className:"text-base","data-testid":"form-title"},t("label.create-entity",{entity:t("label.task")})),d.createElement(s.Z,{form:q,layout:"vertical",onFinish:function(e){var a;if(X.length){var i={from:null==n?void 0:n.name,message:e.title||ee,about:(0,k.ec)(F,te,ne()),taskDetails:{assignees:X.map((function(e){return{id:e.value,type:e.type}})),suggestion:null===(a=U.current)||void 0===a?void 0:a.getEditorContent(),type:w.U.RequestDescription,oldValue:""},type:Z.Th.Task};(0,C.Kl)(i).then((function(){(0,x.XA)(t("server.create-entity-success",{entity:t("label.task")})),O.push((0,I.X3)(F,te,T.M8.ACTIVITY_FEED,g.o.TASKS))})).catch((function(e){return(0,x.Eo)(e)}))}else(0,x.Eo)(t("server.no-task-creation-without-assignee"))}},d.createElement(s.Z.Item,{"data-testid":"title",label:t("label.task-entity",{entity:t("label.title")})+":",name:"title"},d.createElement(l.Z,{disabled:!0,placeholder:t("label.task-entity",{entity:t("label.title")})})),d.createElement(s.Z.Item,{"data-testid":"assignees",label:t("label.assignee-plural")+":",name:"assignees",rules:[{required:!0,message:t("message.field-text-is-required",{fieldText:t("label.assignee-plural")})}]},d.createElement(N.Z,{options:_,value:X,onChange:$,onSearch:function(e){(0,L.Od)(e,j)}})),d.createElement(s.Z.Item,{"data-testid":"description-label",label:t("label.suggest-entity",{entity:t("label.description")})+":",name:"SuggestDescription"},d.createElement(y.Z,{initialValue:"",placeHolder:t("label.suggest-entity",{entity:t("label.description")}),ref:U,style:{marginTop:"4px"},onTextChange:function(e){Q(e)}})),d.createElement(s.Z.Item,{noStyle:!0},d.createElement(r.Z,{className:"w-full justify-end","data-testid":"cta-buttons",size:16},d.createElement(o.Z,{type:"link",onClick:function(){return O.goBack()}},t("label.back")),d.createElement(o.Z,{"data-testid":"submit-test",htmlType:"submit",type:"primary"},t(J?"label.suggest":"label.submit")))))))},pageTitle:t("label.task"),secondPanel:{minWidth:60,flex:.4,children:d.createElement(v.Z,{hideBreadcrumbs:!0,showTags:!0,id:null!==(e=Y.id)&&void 0!==e?e:"",source:(0,a.pi)((0,a.pi)({},Y),{entityType:F})})}})}},25131:function(e,t,n){n.d(t,{Z:function(){return A}});var a=n(70655),i=n(19650),s=n(56256),l=n(34041),r=n(23031),o=n(96486),c=n(67294),u=n(43443),d=n(40773),m=n(37878),p=n(55546),g=n(93379),h=n.n(g),f=n(7795),y=n.n(f),b=n(90569),v=n.n(b),E=n(3565),S=n.n(E),T=n(19216),w=n.n(T),Z=n(44589),C=n.n(Z),I=n(71068),k={};k.styleTagTransform=C(),k.setAttributes=S(),k.insert=v().bind(null,"head"),k.domAPI=y(),k.insertStyleElement=w(),h()(I.Z,k),I.Z&&I.Z.locals&&I.Z.locals;var A=function(e){var t=e.value,n=void 0===t?[]:t,g=e.onSearch,h=e.onChange,f=e.options,y=(0,c.useMemo)((function(){var e=(0,o.groupBy)(f,(function(e){return e.type})),t=[];return(0,o.isUndefined)(e.team)||t.push({type:"group",label:"Teams",value:p.jc.TEAM,options:e.team.map((function(e){return(0,a.pi)((0,a.pi)({},e),{label:c.createElement(i.Z,{"data-testid":"assignee-option",key:e.value},c.createElement(u.ReactComponent,{height:16,width:16}),c.createElement(s.Z.Text,null,e.label))})}))}),(0,o.isUndefined)(e.user)||t.push({type:"group",label:"Users",value:p.jc.USER,options:e.user.map((function(e){return(0,a.pi)((0,a.pi)({},e),{label:c.createElement("div",{"data-testid":"assignee-option-"+e.label},c.createElement(d.w,{className:"assignee-item",id:e.value,name:e.label,size:m.e.small}))})}))}),t}),[f]);return c.createElement(l.Z,{showSearch:!0,className:"ant-select-custom select-assignee","data-testid":"select-assignee",defaultActiveFirstOption:!1,filterOption:!1,mode:"multiple",notFoundContent:null,options:y,placeholder:(0,r.t)("label.select-to-search"),showArrow:!1,value:n.length?n:void 0,onChange:function(e,t){var n=t.map((function(e){return{label:e["data-label"],value:e.value,type:e.type}}));h(n)},onSearch:g})}}}]);