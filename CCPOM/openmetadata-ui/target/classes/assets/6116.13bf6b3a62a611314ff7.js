"use strict";(self.webpackChunkopen_metadata=self.webpackChunkopen_metadata||[]).push([[6116],{46116:function(e,t,a){a.r(t);var l=a(70655),n=a(71230),r=a(15746),i=a(56256),s=a(49409),u=a(19650),c=a(71577),o=a(34901),m=a(96486),d=a(67294),f=a(68432),p=a(15137),b=a(26387),y=a(69523),v=a(80646),E=a(19793),h=a(96162),w=a(85303),C=a(80897),Z=a(24671),k=a(96840),N=a(46321),g=a(87684),R=(0,k.DW)(h.lx.POLICIES);t.default=function(){var e=(0,f.$)().t,t=(0,p.k6)(),a=(0,p.UO)().fqn,h=(0,l.CR)((0,d.useState)(!1),2),x=h[0],L=h[1],S=(0,l.CR)((0,d.useState)({}),2),T=S[0],_=S[1],D=(0,l.CR)((0,d.useState)({name:"",description:"",resources:[],operations:[],condition:"",effect:w.Q.Allow}),2),I=D[0],O=D[1],P=(0,d.useMemo)((function(){return[{name:e("label.setting-plural"),url:(0,k.si)()},{name:e("label.policy-plural"),url:R},{name:(0,Z.C_)(T),url:(0,k.Hr)(a)},{name:e("label.add-new-entity",{entity:e("label.rule")}),url:""}]}),[a,T]),j=function(){t.push((0,k.Hr)(a))};return(0,d.useEffect)((function(){(0,l.mG)(void 0,void 0,void 0,(function(){var e,t;return(0,l.Jh)(this,(function(l){switch(l.label){case 0:L(!0),l.label=1;case 1:return l.trys.push([1,3,4,5]),[4,(0,C.u7)(a,"owner,location,teams,roles")];case 2:return e=l.sent(),_(null!=e?e:{}),[3,5];case 3:return t=l.sent(),(0,N.Eo)(t),[3,5];case 4:return L(!1),[7];case 5:return[2]}}))}))}),[a]),x?d.createElement(y.Z,null):d.createElement(v.Z,{pageTitle:e("label.add-new-entity",{entity:e("label.rule")})},d.createElement(n.Z,{className:"h-auto p-y-xss",gutter:[16,16]},d.createElement(r.Z,{offset:5,span:14},d.createElement(b.Z,{className:"m-b-md",titleLinks:P}),d.createElement(i.Z.Paragraph,{className:"text-base","data-testid":"add-rule-title"},e("label.add-new-entity",{entity:e("label.rule")})),d.createElement(s.Z,{"data-testid":"rule-form",id:"rule-form",initialValues:{ruleEffect:I.effect},layout:"vertical",onFinish:function(){return(0,l.mG)(void 0,void 0,void 0,(function(){var t,a,n,r,i,s;return(0,l.Jh)(this,(function(u){switch(u.label){case 0:t=(0,l.pi)((0,l.pi)({},I),{name:(0,m.trim)(I.name)}),a=t.condition,n=(0,l._T)(t,["condition"]),r=(0,o.qu)(T,(0,l.pi)((0,l.pi)({},T),{rules:(0,l.ev)((0,l.ev)([],(0,l.CR)(T.rules)),[a?(0,l.pi)((0,l.pi)({},n),{condition:a}):n])})),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,(0,C.$j)(r,T.id)];case 2:return u.sent()&&j(),[3,4];case 3:return i=u.sent(),(null===(s=i.response)||void 0===s?void 0:s.status)===E.NL.CONFLICT?(0,N.Eo)(e("server.entity-already-exist",{entity:e("label.rule"),entityPlural:e("label.rule-lowercase-plural"),name:I.name})):(0,N.Eo)(i,e("server.create-entity-error",{entity:e("label.rule-lowercase")})),[3,4];case 4:return[2]}}))}))}},d.createElement(g.Z,{ruleData:I,setRuleData:O}),d.createElement(u.Z,{align:"center",className:"w-full justify-end"},d.createElement(c.Z,{"data-testid":"cancel-btn",type:"link",onClick:j},e("label.cancel")),d.createElement(c.Z,{"data-testid":"submit-btn",form:"rule-form",htmlType:"submit",type:"primary"},e("label.submit")))))))}}}]);